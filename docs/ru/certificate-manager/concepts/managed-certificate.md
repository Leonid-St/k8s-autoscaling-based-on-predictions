# Сертификат от Let's Encrypt

С помощью {{ certificate-manager-name }} вы можете создавать TLS-сертификаты от Let's Encrypt. Вы запрашиваете выпуск сертификата и проходите процедуру проверки прав на домены, после этого {{ certificate-manager-name }} управляет этим сертификатом, взаимодействуя с Let's Encrypt вместо вас.

Let's Encrypt предоставляет Domain Validation TLS-сертификаты со сроком действия 90 дней. Если вам нужны Organization Validation или Extended Validation сертификаты, воспользуйтесь сторонним центром сертификации для получения сертификата, и после этого загрузите его в {{ certificate-manager-name }}. Подробнее об этом читайте в разделе [Пользовательский сертификат](imported-certificate.md). 

Сертификат, созданный с помощью {{ certificate-manager-name }}, можно использовать только в [указанных](services.md) сервисах {{ yandex-cloud }}.

## Получение сертификата {#request}

1. Укажите список доменов, для которых вам необходимо выпустить сертификат.
1. Выберите тип проверки прав на домен: `HTTP` или `DNS`.

    Статус сертификата после создания запроса — `Validating`. 
1. Для выпуска сертификата пройдите процедуру проверки прав на домены, которые вы указали ранее.

    В зависимости от выбранного типа проверки, самостоятельно разместите файл на веб-сервере либо добавьте ресурсную запись `TXT` или `CNAME` с нужным значением в DNS-сервисе. Подробнее о типах проверки и способах их прохождения читайте в разделе [{#T}](challenges.md).

    {% include [checking-domain-rights-cname](../../_includes/certificate-manager/checking-domain-rights-cname.md) %}

1. После успешного прохождения проверки прав на домены, сертификат будет выпущен, и перейдет в статус `Issued`. Вы можете использовать сертификат в сервисах, интегрированных с {{ certificate-manager-name }}.

{% note warning %}

Если за одну неделю не удастся успешно пройти процедуру проверки прав на домены, то сертификат не будет выпущен, и его статус изменится на `Invalid`.  

{% endnote %}

## Статусы выпуска сертификата {#issue-statuses}

Посмотреть этапы выпуска сертификата, их подробное описание и результат каждого из этапов можно в консоли управления. Эта информация содержится в логах каждого сертификата.

Выпуск сертификата Let's Encrypt включает следующие этапы:

1. Запрос сертификата.

    На этом этапе генерируется пара асимметричных ключей, создается аккаунт в Let's Encrypt и отправляется запрос на сертификат.

1. Генерация испытаний.

    На этом этапе формируются задания для проверки прав на домены по стандарту [ACME](https://tools.ietf.org/html/rfc8555).

1. Проверка прохождения испытаний — проверка прав на домены.
   
    На этом этапе проверяется, что вы распоряжаетесь доменами, для которых запрашивали сертификат. Чтобы этап завершился успешно, выполните действия для выбранного типа проверки:

    * `HTTP` — разместите файл на веб-сервере.
    * `DNS` — добавьте запись в DNS-сервисе.
     
     Система каждые полчаса проверяет, выполнены ли условия испытаний. Пока условия не выполнены, этап остается в статусе `Error`. Если испытания не пройдены за неделю, запрос на сертификат отклоняется.

1. Завершение выпуска сертификата. На этом этапе автоматически выполняются следующие действия:

    1. Создание запроса на подпись сертификата (Certificate Signing Request — CSR).
    1. Проверка испытаний на стороне Let's Encrypt.
    1. Отправка запроса на подпись сертификата в Let's Encrypt.
    1. Получение ответа Let's Encrypt о выпуске сертификата.
    1. Завершение выпуска и сохранение сертификата в {{ certificate-manager-name }}.

Переход на каждый следующий этап возможен, когда предыдущий завершается со статусом `Success`.

## Обновление сертификата {#renew}

{% note warning %}

Обновление сертификата требует от вас действий, описанных ниже. Внимательно следите за временем жизни созданных сертификатов, чтобы своевременно обновлять их.

{% endnote %}

1. {{ certificate-manager-name }} запускает процедуру обновления сертификата за 30 дней до окончания срока действия сертификата.
    
    Статус сертификата после запуска процедуры обновления — `Renewing`.
1. Пройдите процедуру проверки прав на домены.

    В зависимости от выбранного типа проверки обновите файл на веб-сервере или обновите `TXT`-запись в DNS-сервисе на новое значение. Подробнее читайте в разделе [Проверка прав на домен](challenges.md).
    
    {% note info %}
    
    Если сертификат используется в [статическом сайте в {{ objstorage-name }}](../../tutorials/web/static/index.md) и не содержит [доменов с маской](https://en.wikipedia.org/wiki/Wildcard_certificate),
    то процедура проверки прав может быть пройдена автоматически. Подробнее в разделе [Автоматическая проверка прав](challenges.md#auto). 
    
    {% endnote %}
    
1. После успешного прохождения проверки прав на домены, сертификат будет обновлен, и перейдет в статус `Issued`. Все ресурсы, использующие сертификат, получат его новую версию. 

Сертификат не будет обновлен, если процедура проверки прав на домены завершилась ошибкой хотя бы для одного домена. При этом статус сертификата изменится на `Renewal_failed` и он будет продолжать действовать до окончания срока действия.
Спустя некоторое время после неудачного обновления будет предпринята новая попытка обновить сертификат. 
 
Чтобы избежать проблем с доступом к ресурсам, которые используют сертификат в статусе `Renewal_failed`:
1. До истечения срока действия сертификата выпустите и [добавьте новый сертификат от Let's Encrypt](../operations/managed/cert-create.md).
1. [Пройдите процедуру проверки прав на домены](../operations/managed/cert-validate.md).
1. Используйте новый сертификат в ваших ресурсах.

## Примеры использования {#examples}

* [{#T}](../tutorials/nginx-ingress-certificate-manager.md)
* [{#T}](../tutorials/gatsby-static-website.md)
* [{#T}](../tutorials/virtual-hosting.md)
* [{#T}](../tutorials/tls-termination/index.md)

#### См. также {#see-also}

- [Проверка прав на домен](challenges.md)
- [Интегрированные с {{ certificate-manager-name }} сервисы](services.md)				
